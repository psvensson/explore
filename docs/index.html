<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Dungeon Web</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="styles/tileset_editor.css">
    <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.module.js",
        "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.155.0/examples/jsm/",
        "handlebars": "https://cdn.jsdelivr.net/npm/handlebars@4.7.8/dist/handlebars.min.js"
      }
    }
    </script>
</head>
<body>
    <header>
        <h1>My Dungeon Web</h1>
        <p>Explore and generate dungeons in a 3D environment.</p>
        <div id="header-version" style="position:absolute;top:10px;right:10px;background:#0f2740;color:#cfe6ff;padding:6px 10px;border-radius:6px;font-size:13px;font-weight:600;letter-spacing:0.3px">Version: loadingâ€¦</div>
    </header>
    <!-- Widget Containers - Main UI Structure -->
    <div id="main-tabs-container"></div>
    <div id="main-content">
        <div id="scene-viewer-container"></div>
        <div id="generator-panel-container"></div>
        <div id="map-editor-container" style="display: none;"></div>
        <div id="tileset-editor-container" style="display: none;"></div>
    </div>

    <!-- Application Bootstrap - Load First -->
    <script type="module" src="dungeon/bootstrap.js"></script>
    
    <!-- Widget System Dependencies - Load Order Critical -->
    <script src="https://cdn.jsdelivr.net/npm/handlebars@4.7.8/dist/handlebars.min.js"></script>
    <script src="ui/Widget.js"></script>
    <script src="ui/widget-handlebars-helpers.js"></script>
    
    <!-- Initialize Widget System -->
    <script type="module">
        // Disable old UI system to prevent conflicts
        window.__DISABLE_OLD_UI__ = true;
        
        // Import widget bootstrap
        import { WidgetBootstrap } from './ui/widget-bootstrap.js';
        
        console.log('[App] Starting widget-based UI...');
    </script>
    <!-- Tileset module (NDWFC prototypes). NDWFC core dynamically imported on demand. -->
    <script type="module" src="dungeon/tileset.js"></script>
    <script type="module" src="renderer/renderer.js"></script>
    <script type="module" src="ui/ui.js"></script>
        <script type="module">
            // Mirror version into header badge
            fetch('version.json', { cache: 'no-store' })
                .then(r => r.ok ? r.json() : null)
                .then(v => {
                    const el = document.getElementById('header-version');
                    if (!el) return;
                    if (v && (v.build!=null || v.version)) el.textContent = `Version: ${v.version||v.build}`;
                    else el.textContent = 'Version: n/a';
                })
                .catch(() => {
                    const el = document.getElementById('header-version');
                    if (el) el.textContent = 'Version: n/a';
                });
        </script>
    <script type="module" src="dungeon/dungeon.js"></script>
</body>
</html>